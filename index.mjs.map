{"version":3,"file":"index.mjs","sources":["src/lib/is.js","src/lib/are-rules-potential-nesting-at-rule.js","src/lib/are-rules-potential-nesting-media-rule.js","src/lib/are-rules-potential-nesting-rule.js","src/lib/fix-nesting-at-rule.js","src/lib/fix-nesting-media-rule.js","src/lib/fix-nesting-rule.js","src/index.js"],"sourcesContent":["export default function is(value, ...keys) {\n\tconst length = keys.length;\n\tconst matches = keys.pop();\n\tconst subvalue = keys.reduce((result, key) => Object(result)[key], value);\n\n\treturn length ?\n\t\t[].concat(matches).some(\n\t\t\tmatch => match instanceof RegExp\n\t\t\t\t? match.test(subvalue)\n\t\t\t: match === subvalue\n\t\t)\n\t: Boolean(value);\n}\n","export default function areRulesPotentialNestingAtRule(rule1, rule2, opts) {\n\tconst except = [].concat(Object(opts).except || []);\n\tconst only = [].concat(Object(opts).only || []);\n\n\treturn rule1.selectors && rule2.selectors && rule2.selectors.every(\n\t\trule2Selector => rule1.selectors.every(\n\t\t\trule1Selector =>\n\t\t\t\trule2Selector.length < rule1Selector.length &&\n\t\t\t\t` ${rule2Selector}` === rule1Selector.slice(-rule2Selector.length - 1) &&\n\t\t\t\t(!except.length || except.some(\n\t\t\t\t\tentry => entry instanceof RegExp\n\t\t\t\t\t\t? !entry.test(rule1Selector.slice(0, -rule2Selector.length - 1))\n\t\t\t\t\t: entry !== rule1Selector.slice(0, -rule2Selector.length - 1)\n\t\t\t\t)) &&\n\t\t\t\t(!only.length || only.some(\n\t\t\t\t\tentry => entry instanceof RegExp\n\t\t\t\t\t\t? entry.test(rule1Selector.slice(0, -rule2Selector.length - 1))\n\t\t\t\t\t: entry === rule1Selector.slice(0, -rule2Selector.length - 1)\n\t\t\t\t))\n\t\t)\n\t);\n}\n","export default function areRulesPotentialNestingMediaRule(rule1, rule2, opts) {\n\tconst except = [].concat(Object(opts).except || []);\n\tconst only = [].concat(Object(opts).only || []);\n\n\tconst isRule2MediaRule = rule2.type === 'atrule' && rule2.name === 'media';\n\tconst rule3 = isRule2MediaRule && rule2.nodes && rule2.nodes[0];\n\n\treturn rule1 && rule3 &&\n\trule1.selector && rule3.selector &&\n\trule1.selector === rule3.selector &&\n\t(!except.length || except.some(\n\t\tentry => entry instanceof RegExp\n\t\t\t? !entry.test(rule1.selector)\n\t\t: entry !== rule1.selector\n\t)) &&\n\t(!only.length || only.some(\n\t\tentry => entry instanceof RegExp\n\t\t\t? entry.test(rule1.selector)\n\t\t: entry === rule1.selector\n\t));\n}\n","export default function areRulesPotentialNestingRule(rule1, rule2, opts) {\n\tconst except = [].concat(Object(opts).except || []);\n\tconst only = [].concat(Object(opts).only || []);\n\n\tconst result = rule1.selectors && rule2.selectors && rule2.selectors.every(\n\t\trule2Selector => rule1.selectors.every(\n\t\t\trule1Selector =>\n\t\t\t\trule2Selector.length < rule1Selector.length &&\n\t\t\t\trule2Selector === rule1Selector.slice(0, rule2Selector.length) &&\n\t\t\t\t!/^[A-Za-z0-9-_]/.test(rule1Selector.slice(rule2Selector.length)) &&\n\t\t\t\t(!except.length || except.some(\n\t\t\t\t\tentry => entry instanceof RegExp\n\t\t\t\t\t\t? !entry.test(rule1Selector.slice(rule2Selector.length))\n\t\t\t\t\t: entry !== rule1Selector.slice(rule2Selector.length)\n\t\t\t\t)) &&\n\t\t\t\t(!only.length || only.some(\n\t\t\t\t\tentry => entry instanceof RegExp\n\t\t\t\t\t\t? entry.test(rule1Selector.slice(rule2Selector.length))\n\t\t\t\t\t: entry === rule1Selector.slice(rule2Selector.length)\n\t\t\t\t))\n\t\t)\n\t);\n\treturn result\n}\n","import postcss from 'postcss';\n\nexport default function fixNestingAtRule(rule1, rule2) {\n\trule1.remove();\n\n\trule1.selectors = rule1.selectors.map(\n\t\tselector => `${selector.slice(0, -rule2.selector.length - 1)} &`\n\t);\n\n\tconst atrule = Object.assign(\n\t\tpostcss.atRule({\n\t\t\tname: 'nest',\n\t\t\tparams: String(rule1.selector)\n\t\t}),\n\t\t{\n\t\t\traws: Object.assign(rule1.raws, {\n\t\t\t\tafterName: ' '\n\t\t\t}),\n\t\t\tsource: rule1.source\n\t\t}\n\t);\n\n\tatrule.append(...rule1.nodes);\n\n\trule2.append(atrule);\n}\n","export default function fixNestingMediaRule(rule1, media) {\n\tconst isMediaMediaRule = media.type === 'atrule' && media.name === 'media';\n\n\tif (isMediaMediaRule) {\n\t\tconst rule2 = media.nodes[0];\n\t\tconst mediaRule = media.clone().removeAll();\n\n\t\tmediaRule.append(\n\t\t\trule2.nodes.map(node => node.clone())\n\t\t);\n\n\t\trule1.append(mediaRule);\n\n\t\trule2.remove();\n\n\t\tif (!media.nodes.length) {\n\t\t\tmedia.remove();\n\t\t}\n\t}\n}\n","export default function fixNestingRule(rule1, rule2) {\n\trule1.selectors = rule1.selectors.map(\n\t\tselector => `&${selector.slice(rule2.selector.length)}`\n\t);\n\n\trule2.append(rule1);\n}\n","import stylelint from 'stylelint';\nimport is from './lib/is';\nimport areRulesPotentialNestingAtRule from './lib/are-rules-potential-nesting-at-rule';\nimport areRulesPotentialNestingMediaRule from './lib/are-rules-potential-nesting-media-rule';\nimport areRulesPotentialNestingRule from './lib/are-rules-potential-nesting-rule';\nimport fixNestingAtRule from './lib/fix-nesting-at-rule';\nimport fixNestingMediaRule from './lib/fix-nesting-media-rule';\nimport fixNestingRule from './lib/fix-nesting-rule';\n\nexport const ruleName = 'csstools/use-nesting';\n\nexport default stylelint.createPlugin(ruleName, (action, opts, context) => {\n\tconst shouldFix = is(context, 'fix', true);\n\n\treturn async (root, result) => {\n\t\t// validate the action\n\t\tconst isActionValid = stylelint.utils.validateOptions(result, ruleName, {\n\t\t\tactual: action,\n\t\t\tpossible() {\n\t\t\t\treturn is(action, ['always', 'ignore', true, false, null]);\n\t\t\t}\n\t\t});\n\n\t\tif (isActionValid) {\n\t\t\tif (is(action, ['always', true])) {\n\t\t\t\tresult.root.walk(rule => {\n\t\t\t\t\tlet isProcessing = true;\n\n\t\t\t\t\twhile (isProcessing) {\n\t\t\t\t\t\tisProcessing = false;\n\n\t\t\t\t\t\tconst prev = rule.prev();\n\n\t\t\t\t\t\tconst isRuleValid = rule && (rule.type === 'rule' || rule.type === 'atrule');\n\t\t\t\t\t\tconst isPrevValid = prev && (prev.type === 'rule' || prev.type === 'atrule');\n\n\t\t\t\t\t\t// if the previous node is also a rule\n\t\t\t\t\t\tif (isRuleValid && isPrevValid) {\n\t\t\t\t\t\t\tif (areRulesPotentialNestingRule(rule, prev, opts)) {\n\t\t\t\t\t\t\t\t// fix or report the current rule if it could be nested inside the previous rule\n\t\t\t\t\t\t\t\tif (shouldFix) {\n\t\t\t\t\t\t\t\t\tfixNestingRule(rule, prev);\n\n\t\t\t\t\t\t\t\t\tisProcessing = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treport(rule, prev, result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (areRulesPotentialNestingRule(prev, rule, opts)) {\n\t\t\t\t\t\t\t\t// fix or report the previous rule if it could be nested inside the current rule\n\t\t\t\t\t\t\t\tif (shouldFix) {\n\t\t\t\t\t\t\t\t\tfixNestingRule(prev, rule);\n\n\t\t\t\t\t\t\t\t\tisProcessing = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treport(prev, rule, result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (areRulesPotentialNestingAtRule(rule, prev, opts)) {\n\t\t\t\t\t\t\t\t// fix or report the current rule if it could be nested inside the previous rule\n\t\t\t\t\t\t\t\tif (shouldFix) {\n\t\t\t\t\t\t\t\t\tfixNestingAtRule(rule, prev);\n\n\t\t\t\t\t\t\t\t\tisProcessing = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treport(rule, prev, result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (areRulesPotentialNestingAtRule(prev, rule, opts)) {\n\t\t\t\t\t\t\t\t// fix or report the previous rule if it could be nested inside the current rule\n\t\t\t\t\t\t\t\tif (shouldFix) {\n\t\t\t\t\t\t\t\t\tfixNestingAtRule(prev, rule);\n\n\t\t\t\t\t\t\t\t\tisProcessing = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treport(prev, rule, result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (areRulesPotentialNestingMediaRule(rule, prev, opts)) {\n\t\t\t\t\t\t\t\t// fix or report the current rule if it could be nested inside the previous rule\n\t\t\t\t\t\t\t\tif (shouldFix) {\n\t\t\t\t\t\t\t\t\tfixNestingMediaRule(rule, prev);\n\n\t\t\t\t\t\t\t\t\tisProcessing = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treport(rule, prev, result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if (areRulesPotentialNestingMediaRule(prev, rule, opts)) {\n\t\t\t\t\t\t\t\t// fix or report the current rule if it could be nested inside the previous rule\n\t\t\t\t\t\t\t\tif (shouldFix) {\n\t\t\t\t\t\t\t\t\tfixNestingMediaRule(prev, rule);\n\n\t\t\t\t\t\t\t\t\tisProcessing = true;\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\treport(prev, rule, result);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t};\n});\n\nexport const messages = stylelint.utils.ruleMessages(ruleName, {\n\texpected: (node, prev) => {\n\t\tconst outside = prev.type === 'atrule' ? `@${prev.name} ${prev.params}` : node.selector;\n\t\tconst inside = prev.type === 'atrule' ? node.selector : prev.selector;\n\t\tconst message = `Expected \"${outside}\" inside \"${inside}\".`;\n\n\t\treturn message;\n\t}\n});\n\nconst report = (rule1, rule2, result) => {\n\tstylelint.utils.report({\n\t\tmessage: messages.expected(rule1, rule2),\n\t\tnode: rule1,\n\t\tresult,\n\t\truleName\n\t});\n};\n"],"names":["is","value","keys","length","matches","pop","subvalue","reduce","result","key","Object","concat","some","match","RegExp","test","Boolean","areRulesPotentialNestingAtRule","rule1","rule2","opts","except","only","selectors","every","rule2Selector","rule1Selector","slice","entry","areRulesPotentialNestingMediaRule","isRule2MediaRule","type","name","rule3","nodes","selector","areRulesPotentialNestingRule","fixNestingAtRule","remove","map","atrule","assign","postcss","atRule","params","String","raws","afterName","source","append","fixNestingMediaRule","media","isMediaMediaRule","mediaRule","clone","removeAll","node","fixNestingRule","ruleName","stylelint","createPlugin","action","context","shouldFix","root","isActionValid","utils","validateOptions","actual","possible","walk","rule","isProcessing","prev","isRuleValid","isPrevValid","report","messages","ruleMessages","expected","outside","inside","message"],"mappings":"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"}